<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv= "Cache-Control" content= "no-cache" /> 
    <meta http-equiv= "Expires" content= "0" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta content="telephone=no" name="format-detection" />
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" type="text/css" href="styles/css/style.css"/>
    <title>我的订单</title>       
</head>
<body>
    <!-- wap头部 start-->
    <div class="header-blank"></div>
    <header class="header-common">
        <section>
            <div class="goback"><!-- <i></i> --></div>
            <div class="h-title">我的订单</div>
            <div class="btn"></div>
        </section>
    </header>
    <ul class="order-list"></ul>
    <ul class="nav-list">
        <li><i class="icon1"></i><p>抢单</p></li>
        <li class="on"><i class="icon2"></i><p>航程</p></li>
        <li><i class="icon3"></i><p>我的</p></li>
    </ul>
    <div class="nav-blank"></div>
    <script type="text/html" id="listTempl">
        {{each list as list i}}
            <li status="{{list.status}}">
                <div class="o-title o-title2">
                    <div class="name">{{list.goodsName}}{{list.preTon}}吨</div>
                    <div class="state"><span>{{list.statusName}}</span><i class="arrow"></i></div>
                </div>
                <div class="info-box">
                    <div class="time"><i class="icon-time"></i><span>装货时间：{{list.desChargeTime}}出发</span></div>
                    <div class="info"><i class="icon-start"></i><span>装货码头：{{list.startLoadName}}</span></div>
                    <div class="info"><i class="icon-end"></i><span>卸货码头：{{list.上海XX}}</span></div>
                    <!-- <p class="order">订单号：{{list.orderNo}}</p> -->
                </div>
                
                <div class="btn-box border-thin">
                    <p class="tip">注：{{list.specialTip}}</p>
                    {{if list.statusName == "待审核"}}
                    <div class="btn border-thin" reserveId="item.reserveId">取消预约</div>
                    {{/if}}
                </div>
            </li>
        {{/each}}
    </script>
    <script src="./scripts/zepto.min.js"></script>
    <script type="text/javascript">
    lazyLoad.require(['https://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js','./scripts/common.js'],function(sm,boatIndex){
        if(boatIndex.isAndroid){
            window.doBack = function(){
                if(android)android.doFinish();
            }
        }
        var params = {
            url:'temp/data/orderList.json',
            data:{},
            parent:$('.order-list'),
            templateId:'listTempl',
            steps:10,
            maxRecords:1000,
            success:function(json, ajaxOptions, elements){
                $(elements).each(function(index,element){
                    var status = $(element).attr('status');
                    $(element).find('.btn').bind('touchend',function(){
                        if(status == '1'){
                            boatIndex.commonAjax({
                                url:'temp/data/checkUser.json',
                                data: {},
                                success:function(data){
                                    if(data.success){
                                        boatIndex.toast('取消成功');
                                        setTimeout(function(){
                                            location.reload();
                                        },1000);
                                    }
                                },
                                error:function(data){
                                    boatIndex.toast('取消失败');
                                }
                            });
                        }
                        else if(status == '3'){
                            window.location.href = 'page06.html';
                        } 
                    });
                    $(element).find('.info-box').bind('touchend',function(){
                        var status = $(this).attr('status');
                        if(status == '1'){
                            window.location.href = 'page04.html';
                        } 
                    });
                });
            }
        };
        var scroll = boatIndex.scrolledAjax(params);
    });
    </script>
</body>
</html>